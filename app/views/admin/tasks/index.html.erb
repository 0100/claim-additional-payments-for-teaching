<% content_for(:page_title) { page_title("Claim #{@claim.reference} checks for #{policy_service_name(@claim.policy.routing_name)}") } %>

<%= link_to "Back", admin_claim_path(@claim), class: "govuk-back-link" %>

<div class="govuk-grid-row">

  <%= render "claim_summary", claim: @claim, heading: @claim.reference %>

  <div class="govuk-grid-column-two-thirds">

    <ol class="app-task-list">

      <% @claim_checking_tasks.applicable_task_names.each_with_index do |task_name, index| %>
        <li>
          <h2 class="app-task-list__section">
            <span class="app-task-list__section-number"><%= index + 1 %>. </span> <%= task_name.humanize %>
          </h2>
          <ul class="app-task-list__items">
            <li class="app-task-list__item">
              <span class="app-task-list__task-name">
                <%= link_to I18n.t("#{@claim.policy.locale_key}.admin.checks.#{task_name}.summary"), admin_claim_task_path(claim_id: @claim.id, name: task_name), class: "govuk-link" %>
              </span>
              <% if @claim.tasks.exists?(name: task_name) %>
                <strong class="govuk-tag app-task-list__task-completed">Completed</strong>
              <% end %>
            </li>
          </ul>
        </li>
      <% end %>

      <li>
        <h2 class="app-task-list__section">
          <span class="app-task-list__section-number"><%= @claim_checking_tasks.applicable_task_names.size + 1 %>. </span> Decision
        </h2>
        <ul class="app-task-list__items">
          <li class="app-task-list__item">
            <span class="app-task-list__task-name">
              <%= link_to "Approve or reject this claim", new_admin_claim_decision_path(@claim), class: "govuk-link" %>
            </span>
            <% if @claim.decision&.approved? %>
              <strong class="govuk-tag app-task-list__task-completed">Approved</strong>
            <% elsif @claim.decision&.rejected? %>
              <strong class="govuk-tag app-task-list__task-completed govuk-tag--alert">Rejected</strong>
            <% end %>
          </li>
        </ul>
      </li>
    </ol>

  </div>
</div>
