<%= render("shared/error_summary", instance: current_claim, errored_field_id_overrides: { "eligibility.employments.school": "claim_eligibility_attributes_employments_attributes_0_school_id_#{@schools.first.id}" }) if current_claim.errors.any?
%>

<%= form_for current_claim, url: claim_path do |form| %>
  <%= form_group_tag current_claim do %>
    <fieldset class="govuk-fieldset" aria-describedby="school-search-result-hint">

      <legend class="govuk-fieldset__legend govuk-fieldset__legend--xl">
        <h1 class="govuk-fieldset__heading">
          <%= t("student_loans.questions.claim_school") %>
        </h1>
      </legend>

      <span id="school-search-result-hint" class="govuk-hint">
        Select your school from the search results.
      </span>

      <%= hidden_field_tag :school_search, params[:school_search] %>

      <%= errors_tag current_claim.eligibility.selected_employment, :school %>

      <div class="govuk-radios">
        <%= form.fields_for :eligibility do |eligibility_fields| %>
          <%= eligibility_fields.fields_for :employments, current_claim.eligibility.selected_employment do |employment_fields| %>
            <%= employment_fields.collection_radio_buttons :school_id, @schools, :id, :name do |b| %>
              <div class="govuk-radios__item">
                <%= b.radio_button class: "govuk-radios__input" %>
                <%= b.label class: "govuk-radios__label govuk-label--s govuk-radios__label govuk-!-padding-0" do %>
                  <div class="school-search__suggestion">
                    <div class="school-search__suggestion-main-section">
                      <div class="govuk-label govuk-radios__label govuk-label--s">
                        <%= b.text %>
                      </div>
                      <span class="govuk-hint govuk-radios__hint"><%= b.object.address %></span>
                    </div>
                    <% if b.object.close_date.present? %>
                      <div class="school-search__closed-status">
                        <span class="govuk-hint govuk-radios__hint govuk-!-margin-bottom-1">Closed on <%= l(b.object.close_date) %></span>
                      </div>
                    <% end %>
                  </div>
                <% end %>
              </div>
            <% end %>
          <% end %>
        <% end %>
      </div>

    </fieldset>
  <% end %>

  <%= form.submit "Continue", class: "govuk-button", data: { module: "govuk-button" } %>
  <%= link_to "Search again",
        claim_path,
        class: "govuk-button govuk-button--secondary",
        role: "button",
        data: { module: "govuk-button" }
  %>

<% end %>
